# 섹션별 조언

> example.md · 2개 조언 대기 중

---

# 로그인 기능 상세 기획서

> ⚠️ 서비스명이 확정되면 제목을 업데이트하세요.

> **문서 상태**: 초안(Draft) | **최종 검토자**: -



## 1. 개요

본 문서는 서비스의 로그인 기능에 대한 상세 기획서입니다.

**대상 독자:** 프론트엔드/백엔드 개발팀, QA팀, 보안팀
**포함 범위:** 사용자 인증, 세션 관리, 보안 정책, API 설계

**범위(Scope):**
- 포함: 이메일 로그인, 소셜 로그인, 비밀번호 찾기, 세션 관리
- 제외: 회원가입, 프로필 관리, 권한(RBAC) 시스템

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 1.0 | 2026-02-23 | 기획팀 | 최초 작성 |
| 1.1 | 2026-02-23 | AI 리뷰어 | AI 리뷰 반영 |

### 1.1 용어 정의

| 용어 | 설명 |
|------|------|
| JWT | JSON Web Token. Header.Payload.Signature 구조의 자가 포함(self-contained) 인증 토큰 |
| TOTP | Time-based One-Time Password |
| Refresh Token Rotation | 갱신 시 새 refresh token 발급하여 재사용 방지 |
| MFA | Multi-Factor Authentication, 2개 이상의 인증 수단을 조합한 인증 방식 |
| CAPTCHA | Completely Automated Public Turing test, 봇 차단용 챌린지 |


## 2. 목표

**비즈니스 목표:**
- 소셜 로그인 도입으로 가입 전환율 15% 향상
- 로그인 관련 CS 문의 30% 감소

**핵심 성과 지표 (KPI):**
- 로그인 성공률: 99.5% 이상 (측정: 성공 수 / 전체 시도 수, 봇 제외)
- 평균 로그인 소요 시간: 3초 이내 (서버 응답 기준)
  - P95: 5초 이내
  - P99: 8초 이내
- 비밀번호 찾기 완료율: 80% 이상

**Non-goals (이번 버전에서 하지 않는 것):**
- Passkey/WebAuthn → v2.0 예정
- SSO 연동 → 엔터프라이즈 플랜 전용
- 다국어 로그인 UI → 국제화 프로젝트에서 별도 진행
**보안 SLA:**
- 비정상 로그인 감지 → 30분 이내 자동 차단
- 비밀번호 탈취 확인 → 즉시 전체 세션 무효화
- 보안 인시던트 보고 → 1시간 이내 보안팀 통보


> **조언 (1건)**
>
> - **[명확성]** (L37) 비즈니스 목표에 기준선(baseline)이 없고, 15%가 상대적 증가인지 절대적 증가인지 모호합니다.

## 3. 인증 및 로그인

본 섹션에서는 지원하는 인증 방식, 세션 관리 정책, 보안 대응 체계를 다룹니다.


### 3.1 인증 방식

추가적으로 다음 소셜 로그인을 지원합니다:

| 제공자 | 프로토콜 | 필수 스코프 | 비고 |
|--------|----------|------------|------|
| Google | OAuth 2.0 | email, profile | 웹/앱 동일 Client ID |
| Apple | Sign In with Apple | email, name | iOS 앱 필수 |
| Kakao | Kakao Login | account_email | 국내 사용자 비율 높음 |

### 3.2 세션 관리

| 항목 | 설정값 |
|------|--------|
| 세션 만료 시간 | 30분 |
| Remember Me | 7일 |
| 동시 세션 | 최대 3개 (초과 시 가장 오래된 세션 자동 만료 + 알림) |
1. **로그인 실패 제한**: 5회 연속 실패 시 점진적 잠금 (1분 → 5분 → 15분 → 30분)
   - CAPTCHA는 3회 실패 후 즉시 활성화
   - 관리자에게 자동 알림 발송 (10회 이상 실패 시)
### 3.3 보안 정책

1. **로그인 실패 제한**: 5회 연속 실패 시 점진적 잠금 (1분 → 5분 → 15분 → 30분)
   - CAPTCHA: 3회 실패 후 즉시 활성화
   - 관리자 알림: 10회 이상 실패 시 자동 발송
2. **2단계 인증 (2FA)**:
   - SMS: 6자리 코드, 3분 유효
   - TOTP: Google Authenticator, Authy 호환
   - 2FA 필수 대상: 관리자 계정, 결제 관련 작업

### 3.4 Rate Limiting

| 대상 | 제한 | 윈도우 | 초과 시 응답 |
|------|------|--------|-------------|
| IP당 로그인 시도 | 20회 | 15분 | `429` + Retry-After 헤더 |
| 계정당 로그인 시도 | 10회 | 10분 | 계정 잠금 + 이메일 알림 |
| 비밀번호 재설정 | 3회 | 1시간 | 쿨다운 안내 |
| 소셜 로그인 콜백 | 30회 | 5분 | IP 차단 + 보안팀 알림 |
3. **IP 기반 차단**: 비정상 로그인 시도 감지

> 보안 관련 이벤트는 모두 감사 로그에 기록되어야 합니다.


> **조언 (1건)**
>
> - **[완전성]** (L63) 3.1 인증 방식에서 이메일 로그인 설명이 전혀 없고 소셜만 기술되어 있습니다. '추가적으로'라는 표현도 무엇에 대한 추가인지 모호합니다.

## 4. 화면 설계

### 4.1 로그인 화면

**접근성 요구사항:**
- 모든 입력 필드에 `label` 연결 (스크린 리더)
- 키보드만으로 전체 플로우 완료 가능
- 색상 대비율 WCAG 2.1 AA 이상

```
┌─────────────────────────┐
│         로고             │
│                         │
│  ┌───────────────────┐  │
│  │ 이메일            │  │
│  └───────────────────┘  │
│  ┌───────────────────┐  │
│  │ 비밀번호          │  │
│  └───────────────────┘  │
│                         │
│  [로그인]               │
│                         │
│  □ 로그인 상태 유지       │
│                         │
│  소셜 로그인             │
│  [G] [A] [K]            │
└─────────────────────────┘
```

**반응형 브레이크포인트:**
- 모바일 (< 768px): 소셜 버튼 세로 배치, 전체 너비
- 태블릿 (768-1024px): 카드 중앙, 최대 480px
- 데스크톱 (> 1024px): 좌측 브랜딩 + 우측 폼

### 4.2 비밀번호 찾기

사용자가 비밀번호를 분실한 경우:
1. 이메일 입력 → [인증 코드 발송] 버튼 클릭
2. 이메일로 인증 코드 수신 (6자리, 5분 유효)
3. 인증 코드 입력 → 검증
4. 새 비밀번호 설정 (비밀번호 규칙 실시간 검증)
5. 변경 완료 → 로그인 화면으로 리디렉트

**예외 처리:**
- 미등록 이메일: "입력하신 이메일로 인증 코드를 발송했습니다" (등록 여부와 무관하게 동일 메시지 — 이메일 열거 공격 방지)
- 인증 코드 만료: 재발송 버튼 활성화 (최대 3회/시간)
- 연속 실패 5회: 1시간 잠금 + 고객센터 안내


## 5. API 명세

### 5.1 로그인 API

- **Endpoint**: `POST /api/auth/login`
- **Content-Type**: `application/json`
- **Rate Limit**: IP당 20회/15분, 계정당 10회/10분
- **Request Body**:
  ```json
  {
    "email": "user@example.com",
    "password": "secureP@ss123",
    "rememberMe": false
  }
  ```
- **Response** (`200 OK`):
  ```json
  {
    "accessToken": "eyJhbG...",
    "refreshToken": "eyJhbG...",
    "expiresIn": 1800,
    "tokenType": "Bearer"
  }
  ```
- **에러 응답**:
  - `400`: 요청 형식 오류 (이메일 누락 등)
  - `401`: 인증 실패 (이메일 또는 비밀번호 불일치)
  - `423`: 계정 잠금 상태
  - `429`: Rate Limit 초과
- **Response**: JWT 토큰 (access + refresh)

### 5.2 토큰 갱신

- **Endpoint**: `POST /api/auth/refresh`
- **설명**: 만료된 access token을 refresh token으로 갱신 (Refresh Token Rotation 적용)
- **Request Body**:
  ```json
  {
    "refreshToken": "eyJhbGciOiJIUzI1NiIs..."
  }
  ```
- **Response** (`200 OK`):
  ```json
  {
    "accessToken": "eyJhbG...",
    "refreshToken": "eyJhbG...(새 토큰)",
    "expiresIn": 1800
  }
  ```
- **에러 응답**:
  - `401`: refresh token 만료 → 재로그인 필요
  - `403`: token 재사용 감지 → 모든 세션 즉시 무효화

### 5.3 로그아웃

- **Endpoint**: `POST /api/auth/logout`
- **Headers**: `Authorization: Bearer {accessToken}`
- **동작**: refresh token 무효화 + 서버 세션 삭제
- **Response** (`204 No Content`)

### 5.4 소셜 로그인

- **Endpoint**: `POST /api/auth/social`
- **Request Body**:
  ```json
  {
    "provider": "google|apple|kakao",
    "code": "authorization_code",
    "redirectUri": "https://..."
  }
  ```
- **Response**: 로그인 API와 동일 (accessToken + refreshToken)


## 5.5 공통 에러 응답 형식

모든 API는 에러 시 다음 형식을 따릅니다:

```json
{
  "error": {
    "code": "AUTH_INVALID_CREDENTIALS",
    "message": "이메일 또는 비밀번호가 일치하지 않습니다",
    "details": {}
  }
}
```

| 에러 코드 | HTTP 상태 | 설명 |
|-----------|-----------|------|
| AUTH_INVALID_CREDENTIALS | 401 | 인증 실패 |
| AUTH_ACCOUNT_LOCKED | 423 | 계정 잠금 |
| AUTH_TOKEN_EXPIRED | 401 | 토큰 만료 |
| AUTH_RATE_LIMITED | 429 | 요청 제한 초과 |



## 6. 일정

| 단계 | 기간 | 시작일 | 종료일 | 담당 | 산출물 |
|------|------|--------|--------|------|--------|
| 설계 리뷰 | 1주 | W1 Mon | W1 Fri | 기획팀 | 기획서 최종본 |
| 백엔드 개발 | 2주 | W2 Mon | W3 Fri | 서버팀 | API + 단위 테스트 |
| 프론트엔드 개발 | 2주 | W2 Mon | W3 Fri | 프론트팀 | UI 구현 |
| QA | 1주 | W4 Mon | W4 Fri | QA팀 | 테스트 리포트 |
| 버그 수정 | 3일 | W5 Mon | W5 Wed | 개발팀 | 수정 완료 |
| 스테이징 배포 | 1일 | W5 Thu | W5 Thu | DevOps | 스테이징 검증 |
| 프로덕션 배포 | 1일 | W5 Fri | W5 Fri | DevOps | 릴리즈 |


